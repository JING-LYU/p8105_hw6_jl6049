---
title: "p8105_hw6_jl6049"
author: "LYU JING"
date: "11/27/2021"
output: github_document
---

```{r}
library(tidyverse)
library(ALSM)
```

Load and clean the data for regression analysis (i.e. convert numeric to factor where appropriate, check for missing data, etc.).
```{r}
birthweight = read.csv("birthweight.csv")
```
```{r}

skimr::skim(birthweight)

```
No missing

`pnumlbw` and `pnumsga` are all zero, so cancel those two columns

```{r}
birthweight_clean =birthweight %>% 
  select(-pnumlbw,-pnumsga) %>% 
  mutate(babysex = factor(babysex),
         frace = factor(frace),
         malform = factor(malform),
         mrace = factor(mrace))
```

Propose a regression model for birthweight. This model may be based on a hypothesized structure for the factors that underly birthweight, on a data-driven model-building process, or a combination of the two. Describe your modeling process and show a plot of model residuals against fitted values – use add_predictions and add_residuals in making this plot.

```{r}
variables = birthweight %>% select(-bwt,-pnumlbw,-pnumsga)

cor(variables)

variables = variables %>% select(-frace,-ppbmi,-ppwt,-ppbmi) 


BestSub(variables,birthweight$bwt) # best subset



variables = variables %>% select(-malform) 

colnames(variables)
```

Use function above to find out proper variables.
From correlation:
`ppwt`,`ppbmi` ,`delwt` and `wtgain` have relation, so I only keep `wtgain` and`delwt`.
`mrace` and `frace` are correlated to each other, so only keep `mrace`

Use BestSub:
`malform` seems not influence the modle a lot so cancel it.


```{r}

fit = lm(bwt ~ babysex + bhead + blength +delwt + fincome + gaweeks + menarche + mheight + momage + mrace  +parity +smoken+  wtgain , data = birthweight_clean)
summary(fit)
```
Based on the understanding, I try to find out if `fincme` and `momage`and `menarche` is useful for our model by using lm model to fit one. I find out `fincome` and `momage`and `menarche` is not significant then cancel it.

```{r}
fit_final = lm(bwt ~ babysex + bhead + blength +delwt + gaweeks + mheight + mrace  +parity +smoken+  wtgain , data = birthweight_clean)
summary(fit_final)
```

```{r}
birthweight_clean %>% 
  modelr::add_predictions(fit_final) %>% 
  modelr::add_residuals(fit_final) %>% 
  ggplot(aes(x = pred, y = resid)) + geom_point(alpha = 0.1)
```


Compare your model to two others:

One using length at birth and gestational age as predictors (main effects only)
One using head circumference, length, sex, and all interactions (including the three-way interaction) between these
Make this comparison in terms of the cross-validated prediction error; use crossv_mc and functions in purrr as appropriate.

Note that although we expect your model to be reasonable, model building itself is not a main idea of the course and we don’t necessarily expect your model to be “optimal”.

